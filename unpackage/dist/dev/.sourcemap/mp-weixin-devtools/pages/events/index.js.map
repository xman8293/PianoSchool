{"version":3,"names":["eventList","common_vendor","ref","currentPage","total","loading","noMore","fetchEvents","_ref","_asyncToGenerator2","_regeneratorRuntime2","mark","_callee","page","res","cacheData","_args","arguments","wrap","_callee$","_context","prev","next","length","undefined","value","Promise","race","er","callFunction","name","data","pageSize","_","reject","setTimeout","Error","sent","result","code","list","concat","_toConsumableArray2","hasMore","index","getStorageSync","t0","showToast","title","message","icon","finish","stop","apply","getStatusClass","status","onMounted","__f__","process","env","UNI_BUILD_TIME","onReachBottom","onPullDownRefresh","removeStorageSync","finally","stopPullDownRefresh","wx","createPage","MiniProgramPage"],"sources":["index.vue","cGFnZXMvZXZlbnRzL2luZGV4LnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"page-container\">\r\n    <view class=\"event-list\">\r\n      <view v-if=\"eventList.length === 0 && !loading\" class=\"empty-tips\">\r\n        <image src=\"/static/empty.png\" class=\"empty-image\"/>\r\n        <text class=\"empty-text\">暂无活动数据</text>\r\n      </view>\r\n\r\n      <view \r\n        v-for=\"(item, index) in eventList\" \r\n        :key=\"item.id\"\r\n        class=\"event-card\"\r\n        @click=\"navigateToDetail(item.id)\"\r\n      >\r\n        <image \r\n          :src=\"item.image\" \r\n          mode=\"aspectFill\" \r\n          class=\"event-image\"\r\n        />\r\n        <view class=\"event-content\">\r\n          <view class=\"event-header\">\r\n            <text class=\"event-title\">{{ item.title }}</text>\r\n            <text \r\n              :class=\"['event-status', getStatusClass(item.status)]\"\r\n              v-if=\"item.status !== '进行中'\"\r\n            >\r\n              {{ item.status }}\r\n            </text>\r\n          </view>\r\n          <view class=\"event-meta\">\r\n            <uni-icons type=\"calendar\" size=\"16\" color=\"#666\"/>\r\n            <text class=\"meta-text\">{{ item.time }}</text>\r\n            <uni-icons type=\"location\" size=\"16\" color=\"#666\" style=\"margin-left: 20rpx\"/>\r\n            <text class=\"meta-text\">{{ item.location }}</text>\r\n          </view>\r\n          <text class=\"event-brief\">{{ item.brief }}</text>\r\n        </view>\r\n      </view>\r\n\r\n      <!-- 加载状态提示 -->\r\n      <view class=\"loading-text\">\r\n        <text v-if=\"loading\">加载中...</text>\r\n        <text v-if=\"noMore\" class=\"no-more\">没有更多了~</text>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted } from 'vue'\r\nimport { onReachBottom, onPullDownRefresh } from '@dcloudio/uni-app'\r\n\r\n// 数据状态\r\nconst eventList = ref([])\r\nconst currentPage = ref(1)\r\nconst pageSize = 10\r\nconst total = ref(0)\r\nconst loading = ref(false)\r\nconst noMore = ref(false)\r\nconst banners = ref([\r\n \r\n])\r\n\r\n// 获取活动数据\r\nconst fetchEvents = async (page = 1) => {\r\n  try {\r\n    loading.value = true\r\n    const res = await Promise.race([\r\n      uniCloud.callFunction({\r\n        name: 'getEvents',\r\n        data: { page, pageSize: 10 }\r\n      }),\r\n      new Promise((_, reject) => \r\n        setTimeout(() => reject(new Error('请求超时')), 10000)\r\n      )\r\n    ])\r\n    \r\n    if (res.result.code === 200) {\r\n      eventList.value = page === 1 \r\n        ? res.result.data.list \r\n        : [...eventList.value, ...res.result.data.list]\r\n      total.value = res.result.data.total\r\n      noMore.value = !res.result.data.hasMore\r\n    }\r\n\r\n    // 在 fetchEvents 函数中检查是否有本地缓存读取\r\n    const cacheData = uni.getStorageSync('eventCache')\r\n    if (cacheData) {\r\n      eventList.value = cacheData\r\n    }\r\n  } catch (error) {\r\n    uni.showToast({\r\n      title: error.message || '加载失败',\r\n      icon: 'none'\r\n    })\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\n// 状态样式\r\nconst getStatusClass = (status) => {\r\n  return {\r\n    '已结束': 'ended',\r\n    '未开始': 'upcoming'\r\n  }[status] || ''\r\n}\r\n\r\n// 页面生命周期\r\nonMounted(() => {\r\n  console.log('Build Timestamp:', process.env.UNI_BUILD_TIME)\r\n  fetchEvents()\r\n})\r\n\r\n// 上拉加载更多\r\nonReachBottom(() => {\r\n  if (!noMore.value) {\r\n    currentPage.value += 1\r\n    fetchEvents(currentPage.value)\r\n  }\r\n})\r\n\r\n// 下拉刷新\r\nonPullDownRefresh(() => {\r\n  currentPage.value = 1\r\n  uni.removeStorageSync('eventCache')\r\n  fetchEvents().finally(() => {\r\n    uni.stopPullDownRefresh()\r\n    uni.showToast({ title: '刷新成功', icon: 'success' })\r\n  })\r\n})\r\n\r\nconst loadMoreEvents = async () => {\r\n  loading.value = true\r\n  try {\r\n    currentPage.value++\r\n    const res = await uniCloud.callFunction({\r\n      name: 'getEvents',\r\n      data: { page: currentPage.value }\r\n    })\r\n    \r\n    if (res.result.data.length === 0) {\r\n      noMore.value = true\r\n    }\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.page-container {\r\n  background: #f5f5f5;\r\n  min-height: 100vh;\r\n}\r\n\r\n.event-swiper {\r\n  height: 300rpx;\r\n  background: #fff;\r\n}\r\n\r\n.swiper-image {\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n.event-list {\r\n  padding: 20rpx;\r\n}\r\n\r\n.event-list.loading {\r\n  opacity: 0.6;\r\n}\r\n\r\n.event-card {\r\n  background: #fff;\r\n  border-radius: 16rpx;\r\n  margin-bottom: 20rpx;\r\n  overflow: hidden;\r\n  box-shadow: 0 2rpx 12rpx rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.event-image {\r\n  width: 100%;\r\n  height: 360rpx;\r\n}\r\n\r\n.event-content {\r\n  padding: 20rpx;\r\n}\r\n\r\n.event-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: flex-start;\r\n  margin-bottom: 16rpx;\r\n}\r\n\r\n.event-title {\r\n  font-size: 32rpx;\r\n  font-weight: 600;\r\n  color: #2A3F54;\r\n  flex: 1;\r\n  margin-right: 20rpx;\r\n}\r\n\r\n.event-status {\r\n  font-size: 24rpx;\r\n  padding: 4rpx 12rpx;\r\n  border-radius: 8rpx;\r\n}\r\n\r\n.event-status.ongoing {\r\n  background: #e6f3ff;\r\n  color: #007BFF;\r\n}\r\n\r\n.event-status.ended {\r\n  background: #f5f5f5;\r\n  color: #999;\r\n}\r\n\r\n.event-meta {\r\n  display: flex;\r\n  align-items: center;\r\n  margin-bottom: 15rpx;\r\n  color: #666;\r\n}\r\n\r\n.meta-text {\r\n  margin-left: 8rpx;\r\n  font-size: 24rpx;\r\n}\r\n\r\n.event-brief {\r\n  font-size: 28rpx;\r\n  color: #666;\r\n  line-height: 1.6;\r\n  display: -webkit-box;\r\n  -webkit-box-orient: vertical;\r\n  -webkit-line-clamp: 2;\r\n  line-clamp: 2;\r\n  overflow: hidden;\r\n}\r\n\r\n.loading-text {\r\n  text-align: center;\r\n  padding: 30rpx;\r\n  color: #999;\r\n}\r\n\r\n.loading-text .no-more {\r\n  display: block;\r\n  font-size: 24rpx;\r\n}\r\n\r\n.empty-tips {\r\n  text-align: center;\r\n  padding: 40rpx;\r\n}\r\n.empty-image {\r\n  width: 200rpx;\r\n  height: 200rpx;\r\n  opacity: 0.6;\r\n}\r\n.empty-text {\r\n  display: block;\r\n  color: #999;\r\n  font-size: 28rpx;\r\n  margin-top: 20rpx;\r\n}\r\n\r\n.event-info::after {\r\n  content: '';\r\n  display: block;\r\n  width: 100%;\r\n  height: 1rpx;\r\n  background-color: #eeeeee;\r\n  margin: 20rpx 0;\r\n}\r\n</style> ","import MiniProgramPage from 'E:/MyProject/PianoSchool/pages/events/index.vue'\nwx.createPage(MiniProgramPage)"],"mappings":"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","ignoreList":[]}