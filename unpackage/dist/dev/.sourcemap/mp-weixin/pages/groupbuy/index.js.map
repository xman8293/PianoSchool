{"version":3,"file":"index.js","sources":["pages/groupbuy/index.vue","../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZ3JvdXBidXkvaW5kZXgudnVl"],"sourcesContent":["<template>\r\n  <view class=\"groupbuy-container\">\r\n    <!-- 新增下拉刷新 -->\r\n    <scroll-view \r\n      scroll-y \r\n      class=\"scroll-view\"\r\n      @refresherrefresh=\"onRefresh\"\r\n      :refresher-enabled=\"true\"\r\n      @scrolltolower=\"loadMore\"\r\n    >\r\n      <!-- 新增加载状态 -->\r\n      <view v-if=\"loading\" class=\"loading-wrapper\">\r\n        <uni-load-more status=\"loading\"></uni-load-more>\r\n      </view>\r\n\r\n      <!-- 顶部标题 -->\r\n      <view class=\"section-header\">\r\n        <text class=\"title\">限时团购</text>\r\n        <text class=\"subtitle\">超值优惠 火热进行中</text>\r\n      </view>\r\n\r\n      <!-- 团购列表 -->\r\n      <view class=\"group-list\">\r\n        <view \r\n          v-for=\"(item, index) in groupList\" \r\n          :key=\"index\"\r\n          class=\"group-item\"\r\n          @click=\"handleJump(item)\"\r\n          hover-class=\"hover-effect\"\r\n        >\r\n          <!-- 新增角标 -->\r\n          <view class=\"corner-tag\">限时特惠</view>\r\n          <image \r\n            :src=\"item.image\" \r\n            mode=\"aspectFill\" \r\n            class=\"product-image\"\r\n            lazy-load\r\n          />\r\n          <view class=\"info\">\r\n            <text class=\"name\">{{ item.name }}</text>\r\n            <view class=\"price-wrapper\">\r\n              <text class=\"current-price\">\r\n                <text class=\"currency\">¥</text>\r\n                {{ formatPrice(item.currentPrice) }}\r\n              </text>\r\n              <text class=\"original-price\">¥{{ item.originalPrice }}</text>\r\n            </view>\r\n            <view class=\"notice\">\r\n              <text class=\"notice-title\">团购须知：</text>\r\n              <text class=\"notice-content\">{{ truncateNotice(item.notice, 40) }}</text>\r\n            </view>\r\n            <view class=\"action-btn\">\r\n              立即参团             \r\n            </view>\r\n          </view>\r\n        </view>\r\n      </view>\r\n\r\n      <!-- 空数据提示 -->\r\n      <view v-if=\"!loading && groupList.length === 0\" class=\"empty-tip\">\r\n        <image src=\"/static/empty.png\" class=\"empty-img\" />\r\n        <text class=\"empty-text\">暂无优惠活动，敬请期待</text>\r\n      </view>\r\n\r\n      <!-- 加载更多 -->\r\n      <uni-load-more \r\n        :status=\"loadStatus\" \r\n        :content-text=\"{\r\n          contentdown: '上拉加载更多',\r\n          contentrefresh: '正在加载...',\r\n          contentnomore: '没有更多了'\r\n        }\"\r\n      />\r\n    </scroll-view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted } from 'vue'\r\nimport { \r\n  formatPrice,\r\n  truncateText,\r\n  formatTime \r\n} from '@/utils/common.js'\r\n\r\n\r\nconst groupList = ref([])\r\nconst loading = ref(true)\r\nconst error = ref(false)\r\nconst currentPage = ref(1)\r\nconst total = ref(0)\r\nconst loadStatus = ref('more')\r\n\r\n\r\nconst loadGroupbuyList = async (page = 1, isRefresh = false) => {\r\n\r\n\r\n  if (loadStatus.value === 'noMore') return\r\n  loadStatus.value = 'loading'\r\n  uni.showLoading({ title: '加载中', mask: true })\r\n\r\n  try {\r\n    const res = await Promise.race([\r\n      uniCloud.callFunction({\r\n        name: 'getGroupbuyList',\r\n        data: {\r\n          page: page,\r\n          pageSize: 10\r\n        }\r\n      }),\r\n      new Promise((_, reject) => \r\n        setTimeout(() => reject(new Error('请求超时')), 10000)\r\n      )\r\n    ])\r\n    \r\n    if (res.result.code === 200) {\r\n      total.value = res.result.data.total\r\n      groupList.value = isRefresh \r\n        ? res.result.data.list \r\n        : [...groupList.value, ...res.result.data.list]\r\n      \r\n      loadStatus.value = res.result.data.list.length < 10 ? 'noMore' : 'more'\r\n      loading.value = false\r\n    } else {\r\n      throw new Error(res.result.msg)\r\n    }\r\n  } catch (e) {\r\n    loading.value = false\r\n    error.value = true\r\n    console.error('加载团购数据失败:', e)\r\n    uni.showToast({\r\n      title: e.message.includes('超时') ? '请求超时，请重试' : '加载失败',\r\n      icon: 'none'\r\n    })\r\n  } finally {\r\n    uni.hideLoading()\r\n    loading.value = false\r\n  }\r\n}\r\n\r\nconst onRefresh = async () => {\r\n  currentPage.value = 1\r\n  await loadGroupbuyList(1, true)\r\n  uni.stopPullDownRefresh()\r\n}\r\n\r\nconst loadMore = () => {\r\n  if (loadStatus.value !== 'more') return\r\n  currentPage.value++\r\n  loadGroupbuyList(currentPage.value)\r\n}\r\n\r\nconst truncateNotice = (text, length) => {\r\n  return text.length > length ? text.substring(0, length) + '...' : text\r\n}\r\n\r\nonMounted(() => {\r\n  loadGroupbuyList()\r\n})\r\n\r\nconst handleJump = (item) => {\r\n  uni.navigateToMiniProgram({\r\n    appId: \"wxde8ac0a21135c07d\",\r\n    path: 'gc/pages/deal/dealdetail/dealdetail?dealid=828645933&shopid=1502583614', \r\n    success(res) {\r\n      console.log('跳转成功', res)\r\n    },\r\n    fail(err) {\r\n      console.error('跳转失败', err)\r\n      uni.showToast({ title: '跳转失败，请稍后重试', icon: 'none' })\r\n    }\r\n  })\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.groupbuy-container {\r\n  padding: 30rpx;\r\n  background: #f5f7fa;\r\n  min-height: 100vh;\r\n}\r\n\r\n.section-header {\r\n  padding: 40rpx 0;\r\n  text-align: center;\r\n}\r\n\r\n.title {\r\n  font-size: 40rpx;\r\n  font-weight: 600;\r\n  color: #2A3F54;\r\n  display: block;\r\n}\r\n\r\n.subtitle {\r\n  font-size: 28rpx;\r\n  color: #666;\r\n  margin-top: 10rpx;\r\n  display: block;\r\n}\r\n\r\n.group-list {\r\n  display: grid;\r\n  gap: 30rpx;\r\n}\r\n\r\n.group-item {\r\n  background: #fff;\r\n  border-radius: 24rpx;\r\n  overflow: hidden;\r\n  box-shadow: 0 8rpx 24rpx rgba(0,0,0,0.08);\r\n  position: relative;\r\n  transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);\r\n}\r\n\r\n.product-image {\r\n  width: 100%;\r\n  height: 400rpx;\r\n  border-radius: 24rpx 24rpx 0 0;\r\n}\r\n\r\n.info {\r\n  padding: 30rpx;\r\n}\r\n\r\n.name {\r\n  font-size: 32rpx;\r\n  color: #2A3F54;\r\n  font-weight: 500;\r\n  line-height: 1.4;\r\n}\r\n\r\n.price-wrapper {\r\n  margin: 20rpx 0;\r\n  display: flex;\r\n  align-items: baseline;\r\n}\r\n\r\n.current-price {\r\n  font-size: 40rpx;\r\n  color: #FF4D4F;\r\n  font-weight: 600;\r\n  margin-right: 20rpx;\r\n}\r\n\r\n.original-price {\r\n  font-size: 28rpx;\r\n  color: #999;\r\n  text-decoration: line-through;\r\n}\r\n\r\n.notice {\r\n  background: #f8f9fa;\r\n  border-radius: 12rpx;\r\n  padding: 20rpx;\r\n  margin: 20rpx 0;\r\n}\r\n\r\n.notice-title {\r\n  color: #2A3F54;\r\n  font-weight: 500;\r\n}\r\n\r\n.notice-content {\r\n  color: #666;\r\n  font-size: 26rpx;\r\n  line-height: 1.4;\r\n}\r\n\r\n.action-btn {\r\n  background: linear-gradient(135deg, #2A3F54, #3A5F7A);\r\n  color: #fff;\r\n  text-align: center;\r\n  padding: 20rpx;\r\n  border-radius: 12rpx;\r\n  font-size: 30rpx;\r\n  margin-top: 20rpx;\r\n  position: relative;\r\n  overflow: hidden;\r\n}\r\n\r\n.action-btn::after {\r\n  content: '';\r\n  position: absolute;\r\n  top: -50%;\r\n  left: -50%;\r\n  width: 200%;\r\n  height: 200%;\r\n  background: rgba(255,255,255,0.1);\r\n  transform: rotate(45deg);\r\n  transition: all 0.5s;\r\n}\r\n\r\n.loading-wrapper {\r\n  text-align: center;\r\n  padding: 20rpx;\r\n}\r\n\r\n.corner-tag {\r\n  position: absolute;\r\n  right: -20rpx;\r\n  top: 20rpx;\r\n  background: #FF4D4F;\r\n  color: #fff;\r\n  padding: 8rpx 30rpx;\r\n  transform: rotate(45deg);\r\n  font-size: 24rpx;\r\n  z-index: 2;\r\n}\r\n\r\n.currency {\r\n  font-size: 28rpx;\r\n  margin-right: 4rpx;\r\n}\r\n\r\n.remaining {\r\n  font-size: 24rpx;\r\n  margin-left: 15rpx;\r\n  opacity: 0.8;\r\n}\r\n\r\n.empty-tip {\r\n  text-align: center;\r\n  padding: 100rpx 0;\r\n}\r\n\r\n.empty-img {\r\n  width: 300rpx;\r\n  height: 300rpx;\r\n  opacity: 0.5;\r\n}\r\n\r\n.empty-text {\r\n  display: block;\r\n  color: #999;\r\n  margin-top: 20rpx;\r\n}\r\n\r\n.scroll-view {\r\n  height: 100vh;\r\n  box-sizing: border-box;\r\n}\r\n\r\n.hover-effect {\r\n  transform: translateY(-4rpx);\r\n  box-shadow: 0 12rpx 30rpx rgba(0,0,0,0.15);\r\n}\r\n</style> ","import MiniProgramPage from 'E:/MyProject/PianoSchool/pages/groupbuy/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","uniCloud","onMounted"],"mappings":";;;;;;;;;;;AAsFA,UAAM,YAAYA,cAAG,IAAC,EAAE;AACxB,UAAM,UAAUA,cAAG,IAAC,IAAI;AACxB,UAAM,QAAQA,cAAG,IAAC,KAAK;AACvB,UAAM,cAAcA,cAAG,IAAC,CAAC;AACzB,UAAM,QAAQA,cAAG,IAAC,CAAC;AACnB,UAAM,aAAaA,cAAG,IAAC,MAAM;AAG7B,UAAM,mBAAmB,OAAO,OAAO,GAAG,YAAY,UAAU;AAG9D,UAAI,WAAW,UAAU;AAAU;AACnC,iBAAW,QAAQ;AACnBC,oBAAG,MAAC,YAAY,EAAE,OAAO,OAAO,MAAM,MAAM;AAE5C,UAAI;AACF,cAAM,MAAM,MAAM,QAAQ,KAAK;AAAA,UAC7BC,cAAAA,GAAS,aAAa;AAAA,YACpB,MAAM;AAAA,YACN,MAAM;AAAA,cACJ;AAAA,cACA,UAAU;AAAA,YACX;AAAA,UACT,CAAO;AAAA,UACD,IAAI;AAAA,YAAQ,CAAC,GAAG,WACd,WAAW,MAAM,OAAO,IAAI,MAAM,MAAM,CAAC,GAAG,GAAK;AAAA,UAClD;AAAA,QACP,CAAK;AAED,YAAI,IAAI,OAAO,SAAS,KAAK;AAC3B,gBAAM,QAAQ,IAAI,OAAO,KAAK;AAC9B,oBAAU,QAAQ,YACd,IAAI,OAAO,KAAK,OAChB,CAAC,GAAG,UAAU,OAAO,GAAG,IAAI,OAAO,KAAK,IAAI;AAEhD,qBAAW,QAAQ,IAAI,OAAO,KAAK,KAAK,SAAS,KAAK,WAAW;AACjE,kBAAQ,QAAQ;AAAA,QACtB,OAAW;AACL,gBAAM,IAAI,MAAM,IAAI,OAAO,GAAG;AAAA,QAC/B;AAAA,MACF,SAAQ,GAAG;AACV,gBAAQ,QAAQ;AAChB,cAAM,QAAQ;AACdD,sBAAAA,wDAAc,aAAa,CAAC;AAC5BA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO,EAAE,QAAQ,SAAS,IAAI,IAAI,aAAa;AAAA,UAC/C,MAAM;AAAA,QACZ,CAAK;AAAA,MACL,UAAY;AACRA,sBAAAA,MAAI,YAAa;AACjB,gBAAQ,QAAQ;AAAA,MACjB;AAAA,IACH;AAEA,UAAM,YAAY,YAAY;AAC5B,kBAAY,QAAQ;AACpB,YAAM,iBAAiB,GAAG,IAAI;AAC9BA,oBAAAA,MAAI,oBAAqB;AAAA,IAC3B;AAEA,UAAM,WAAW,MAAM;AACrB,UAAI,WAAW,UAAU;AAAQ;AACjC,kBAAY;AACZ,uBAAiB,YAAY,KAAK;AAAA,IACpC;AAEA,UAAM,iBAAiB,CAAC,MAAM,WAAW;AACvC,aAAO,KAAK,SAAS,SAAS,KAAK,UAAU,GAAG,MAAM,IAAI,QAAQ;AAAA,IACpE;AAEAE,kBAAAA,UAAU,MAAM;AACd,uBAAkB;AAAA,IACpB,CAAC;AAED,UAAM,aAAa,CAAC,SAAS;AAC3BF,oBAAAA,MAAI,sBAAsB;AAAA,QACxB,OAAO;AAAA,QACP,MAAM;AAAA,QACN,QAAQ,KAAK;AACXA,wBAAAA,MAAA,MAAA,OAAA,mCAAY,QAAQ,GAAG;AAAA,QACxB;AAAA,QACD,KAAK,KAAK;AACRA,wBAAAA,MAAA,MAAA,SAAA,mCAAc,QAAQ,GAAG;AACzBA,wBAAG,MAAC,UAAU,EAAE,OAAO,cAAc,MAAM,QAAQ;AAAA,QACpD;AAAA,MACL,CAAG;AAAA,IACH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC3KA,GAAG,WAAW,eAAe;"}