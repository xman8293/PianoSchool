{"version":3,"file":"index.js","sources":["pages/events/index.vue","../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZXZlbnRzL2luZGV4LnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"page-container\">\r\n    <view class=\"event-list\">\r\n      <view v-if=\"eventList.length === 0 && !loading\" class=\"empty-tips\">\r\n        <text class=\"empty-text\">暂无活动数据</text>\r\n      </view>\r\n\r\n      <view \r\n        v-for=\"(item, index) in eventList\" \r\n        :key=\"item.id\"\r\n        class=\"event-card\"\r\n        @click=\"navigateToDetail(item.id)\"\r\n      >\r\n        <image \r\n          :src=\"item.cover\" \r\n          mode=\"aspectFill\" \r\n          class=\"event-image\"\r\n        />\r\n        <view class=\"event-content\">\r\n          <view class=\"event-header\">\r\n            <text class=\"event-title\">{{ item.title }}</text>\r\n            <text \r\n              :class=\"['event-status', getStatusClass(item.status)]\"\r\n              v-if=\"item.status !== '进行中'\"\r\n            >\r\n              {{ getStatusText(item.status) }}\r\n            </text>\r\n          </view>\r\n          <view class=\"event-meta\">\r\n            <uni-icons type=\"calendar\" size=\"16\" color=\"#666\"/>\r\n            <text class=\"meta-text\">{{ item.time }}</text>\r\n            <uni-icons type=\"location\" size=\"16\" color=\"#666\" style=\"margin-left: 20rpx\"/>\r\n            <text class=\"meta-text\">{{ item.location }}</text>\r\n          </view>\r\n          <text class=\"event-brief\">{{ item.brief }}</text>\r\n        </view>\r\n      </view>\r\n\r\n      <!-- 加载状态提示 -->\r\n      <view class=\"loading-text\">\r\n        <text v-if=\"loading\">加载中...</text>        \r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted } from 'vue'\r\nimport { onReachBottom, onPullDownRefresh } from '@dcloudio/uni-app'\r\n\r\n// 数据状态\r\nconst eventList = ref([])\r\nconst currentPage = ref(1)\r\nconst pageSize = 10\r\nconst total = ref(0)\r\nconst loading = ref(false)\r\nconst noMore = ref(false)\r\nconst banners = ref([\r\n \r\n])\r\n\r\n// 获取活动数据\r\nconst fetchEvents = async (page = 1) => {\r\n  try {\r\n    loading.value = true\r\n    const res = await Promise.race([\r\n      uniCloud.callFunction({\r\n        name: 'getEvents',\r\n        data: { page, pageSize: 10 },\r\n        timeout: 10000\r\n      }),\r\n      new Promise((_, reject) => \r\n        setTimeout(() => reject(new Error('请求超时')), 10000)\r\n      )\r\n    ])\r\n    \r\n    if (res.result.code === 200) {\r\n      eventList.value = page === 1 \r\n        ? res.result.data.list \r\n        : [...eventList.value, ...res.result.data.list]\r\n      total.value = res.result.data.total\r\n      noMore.value = !res.result.data.hasMore\r\n    } else {\r\n      throw new Error(res.result.message)\r\n    }\r\n\r\n  \r\n  } catch (error) {\r\n    uni.showToast({\r\n      title: error.errMsg || error.message,\r\n      icon: 'none',\r\n      duration: 3000\r\n    })\r\n    console.error('完整错误信息:', {\r\n      code: error.errCode,\r\n      message: error.errMsg,\r\n      detail: error\r\n    })\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\n// 状态样式\r\nconst getStatusText = (status) => {\r\n\tswitch (status) {\r\n\t\tcase 'ongoing':\r\n\t\t\treturn '进行中'\r\n\t\tcase 'upcoming':\r\n\t\t\treturn '即将开始'\r\n\t\tcase 'ended':\r\n\t\t\treturn '已结束'\r\n\t\tdefault:\r\n\t\t\treturn ''\r\n\t}\r\n}\r\nconst getStatusClass = (status) => {\r\n\tswitch (status) {\r\n\t\tcase 'ongoing':\r\n\t\t\treturn 'ongoing'\r\n\t\tcase 'upcoming':\r\n\t\t\treturn 'upcoming'\r\n\t\tcase 'ended':\r\n\t\t\treturn 'ended'\r\n\t\tdefault:\r\n\t\t\treturn ''\r\n\t}\r\n}\r\n\r\n// 页面生命周期\r\nonMounted(() => {\r\n  console.log(uni.getSystemInfoSync().SDKVersion) // 获取小程序基础库版本\r\n  console.log(__wxConfig.envVersion) // 获取环境版本\r\n  fetchEvents()\r\n})\r\n\r\n// 上拉加载更多\r\nonReachBottom(() => {\r\n  if (!noMore.value) {\r\n    currentPage.value += 1\r\n    fetchEvents(currentPage.value)\r\n  }\r\n})\r\n\r\n// 下拉刷新\r\nonPullDownRefresh(() => {\r\n  currentPage.value = 1\r\n  uni.removeStorageSync('eventCache')\r\n  fetchEvents().finally(() => {\r\n    uni.stopPullDownRefresh()\r\n    uni.showToast({ title: '刷新成功', icon: 'success' })\r\n  })\r\n})\r\n\r\nconst loadMoreEvents = async () => {\r\n  loading.value = true\r\n  try {\r\n    currentPage.value++\r\n    const res = await uniCloud.callFunction({\r\n      name: 'getEvents',\r\n      data: { page: currentPage.value }\r\n    })\r\n    \r\n    if (res.result.data.length === 0) {\r\n      noMore.value = true\r\n    }\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\n// 添加错误追踪\r\nif (typeof console.trace === 'function') {\r\n  console.trace('当前堆栈信息')\r\n} else {\r\n  console.log('当前环境不支持console.trace')\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.page-container {\r\n  background: #f5f5f5;\r\n  min-height: 100vh;\r\n}\r\n\r\n.event-swiper {\r\n  height: 300rpx;\r\n  background: #fff;\r\n}\r\n\r\n.swiper-image {\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n.event-list {\r\n  padding: 20rpx;\r\n}\r\n\r\n.event-list.loading {\r\n  opacity: 0.6;\r\n}\r\n\r\n.event-card {\r\n  background: #fff;\r\n  border-radius: 16rpx;\r\n  margin-bottom: 20rpx;\r\n  overflow: hidden;\r\n  box-shadow: 0 2rpx 12rpx rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.event-image {\r\n  width: 100%;\r\n  height: 360rpx;\r\n}\r\n\r\n.event-content {\r\n  padding: 20rpx;\r\n}\r\n\r\n.event-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: flex-start;\r\n  margin-bottom: 16rpx;\r\n}\r\n\r\n.event-title {\r\n  font-size: 32rpx;\r\n  font-weight: 600;\r\n  color: #2A3F54;\r\n  flex: 1;\r\n  margin-right: 20rpx;\r\n}\r\n\r\n.event-status {\r\n  font-size: 24rpx;\r\n  padding: 4rpx 12rpx;\r\n  border-radius: 8rpx;\r\n}\r\n\r\n.event-status.ongoing {\r\n  background: #e6f3ff;\r\n  color: #007BFF;\r\n}\r\n\r\n.event-status.ended {\r\n  background: #f5f5f5;\r\n  color: #999;\r\n}\r\n\r\n.event-meta {\r\n  display: flex;\r\n  align-items: center;\r\n  margin-bottom: 15rpx;\r\n  color: #666;\r\n}\r\n\r\n.meta-text {\r\n  margin-left: 8rpx;\r\n  font-size: 24rpx;\r\n}\r\n\r\n.event-brief {\r\n  font-size: 28rpx;\r\n  color: #666;\r\n  line-height: 1.6;\r\n  display: -webkit-box;\r\n  -webkit-box-orient: vertical;\r\n  -webkit-line-clamp: 2;\r\n  line-clamp: 2;\r\n  overflow: hidden;\r\n}\r\n\r\n.loading-text {\r\n  text-align: center;\r\n  padding: 30rpx;\r\n  color: #999;\r\n}\r\n\r\n.loading-text .no-more {\r\n  display: block;\r\n  font-size: 24rpx;\r\n}\r\n\r\n.empty-tips {\r\n  text-align: center;\r\n  padding: 40rpx;\r\n}\r\n.empty-text {\r\n  display: block;\r\n  color: #999;\r\n  font-size: 28rpx;\r\n  margin-top: 20rpx;\r\n}\r\n\r\n.event-info::after {\r\n  content: '';\r\n  display: block;\r\n  width: 100%;\r\n  height: 1rpx;\r\n  background-color: #eeeeee;\r\n  margin: 20rpx 0;\r\n}\r\n</style> ","import MiniProgramPage from 'E:/MyProject/PianoSchool/pages/events/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uniCloud","uni","onMounted","onReachBottom","onPullDownRefresh"],"mappings":"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"}