"use strict";const e=require("../../common/vendor.js");if(!Array){e.resolveComponent("uni-icons")()}const t={__name:"index",setup(t){const o=e.ref([]),n=e.ref(1),a=e.ref(0),r=e.ref(!1),s=e.ref(!1);e.ref([]);const l=async(t=1)=>{try{r.value=!0;const n=await Promise.race([e.er.callFunction({name:"getEvents",data:{page:t,pageSize:10},timeout:1e4}),new Promise(((e,t)=>setTimeout((()=>t(new Error("请求超时"))),1e4)))]);if(200!==n.result.code)throw new Error(n.result.message);o.value=1===t?n.result.data.list:[...o.value,...n.result.data.list],a.value=n.result.data.total,s.value=!n.result.data.hasMore}catch(n){e.index.showToast({title:n.errMsg||n.message,icon:"none",duration:3e3}),console.error("完整错误信息:",{code:n.errCode,message:n.errMsg,detail:n})}finally{r.value=!1}},c=e=>{switch(e){case"ongoing":return"进行中";case"upcoming":return"即将开始";case"ended":return"已结束";default:return""}},i=e=>{switch(e){case"ongoing":return"ongoing";case"upcoming":return"upcoming";case"ended":return"ended";default:return""}};return e.onMounted((()=>{console.log(e.index.getSystemInfoSync().SDKVersion),console.log(__wxConfig.envVersion),l()})),e.onReachBottom((()=>{s.value||(n.value+=1,l(n.value))})),e.onPullDownRefresh((()=>{n.value=1,e.index.removeStorageSync("eventCache"),l().finally((()=>{e.index.stopPullDownRefresh(),e.index.showToast({title:"刷新成功",icon:"success"})}))})),"function"==typeof console.trace?console.trace("当前堆栈信息"):console.log("当前环境不支持console.trace"),(t,n)=>e.e({a:0===o.value.length&&!r.value},(0!==o.value.length||r.value,{}),{b:e.f(o.value,((o,n,a)=>e.e({a:o.cover,b:e.t(o.title),c:"进行中"!==o.status},"进行中"!==o.status?{d:e.t(c(o.status)),e:e.n(i(o.status))}:{},{f:"bfc1697f-0-"+a,g:e.t(o.time),h:"bfc1697f-1-"+a,i:e.t(o.location),j:e.t(o.brief),k:o.id,l:e.o((e=>t.navigateToDetail(o.id)),o.id)}))),c:e.p({type:"calendar",size:"16",color:"#666"}),d:e.p({type:"location",size:"16",color:"#666"}),e:r.value},(r.value,{}))}},o=e._export_sfc(t,[["__scopeId","data-v-bfc1697f"]]);wx.createPage(o);
